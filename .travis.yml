language: java
jdk:
  - oraclejdk8
git:
  depth: false
env:
  global:
    - DOXYGEN_VERSION=1.8.15

addons:
  apt:
    packages:
      - graphviz
      #- doxygen
      #- doxygen-doc
      #- doxygen-latex
      #- doxygen-gui
    update: true

before_cache:
  - mvn clean

cache:
  directories:
    - .autoconf
    - $HOME/.m2

jobs:
  include:
    - name: before_script
      # require the branch name to be master (note for PRs this is the base branch name)
      if: branch = master
      script: ./scripts/install-doxygen.sh
    - name: before_deploy
      if: branch = master
      script: ./scripts/deploy-docs.sh
    - if: branch = master AND tag IS present
      script: mvn clean install

# before_script:
#   # Manually install doxygen, because older versions throw errors on markdown code with images inside 
#   # links (like the build status in the README) and it's the only way to get a newer doxygen in Ubuntu
#   - ./scripts/install-doxygen.sh

# before_deploy:
#   - ./scripts/deploy-docs.sh

deploy:
  - provider: releases
    api_key: $GITHUB_TOKEN
    file_glob: true
    file: target/event-dispatcher-*.jar
    skip_cleanup: true
    prerelease: true
    draft: true
    on:
      #branch: master
      #tags: true
      branch: FerMod
      tags: false
  - provider: pages
    skip_cleanup: true
    github_token: $GITHUB_TOKEN  # Set in the settings page of your repository, as a secure variable
    keep_history: true
    on:
      branch: master
